#!/bin/bash

if [[ ! $RPC_API_KEY ]]; then
  echo "[WARN] RPC_API_KEY not defined. Overwrite it with your custom key to keep track of your tiles"
  exit
fi

if [[ ! $START_MINER ]]; then
  export START_MINER='yes'
fi

if [[ ! $SERVER_PORT ]]; then
  export SERVER_PORT=5000
fi


if [ "$(ls -A "./browser/node_modules" 2>/dev/null)" ]; then
  echo "Starting Decentraland web dashboard! The node will start shortly after"

  if [ ! "$(ls -A "./browser/build" 2>/dev/null)" ]; then
    echo "Building dashboard, this may take a moment"
    ( cd browser && npm run build > /dev/null )
    echo "Done!"
  fi

  node ./browser/server.js --apikey $RPC_API_KEY --serverport $SERVER_PORT --daemon &
else
  echo "Remember to run \"npm install\" inside the browser folder so you can run the Decentraland web dashboard"
fi

sleep 2 # Give the user 2 seconds to read

echo "Starting node"
./bin/decentraland-node \
  --fast \
  --loglevel=info \
  --port=2301 \
  --httpport=8301 \
  --contentport=9301 \
  --prefix="data" \
  --n=testnet \
  --apikey=$RPC_API_KEY \
  --startminer=$START_MINER
